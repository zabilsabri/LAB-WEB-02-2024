<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack Game</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <!-- Dealer Section -->
        <div class="row">
            <div class="col-md-6" style="display: flex; flex-direction: column;">
                <h2>Bandar</h2>
                <div class="judi">
                    <div class="kotak">
                        <div id="dealer-cards"></div>
                    </div>
                    <h3>Total: <span id="dealer-total">0</span></h3>
                </div>
            </div>

            <!-- Player Section -->
            <div class="col-md-6" style="margin-top: 4rem;">
                <div class="judi">
                    <div class="kotak">
                        <div id="player-cards"></div>
                    </div>
                    <h3>Total: <span id="player-total">0</span></h3>
                </div>
            </div>
        </div>

        <!-- Betting Section -->
        <div class="row mt-4" id="pemain">
            <div class="col-md-6">
                <h3 class="duit">Uang Anda: $ <span id="player-money" style="color: green">5000</span></h3>
                <div class="input-group mb-3">
                    <button class="btn btn-danger" id="decrease-bet">-100</button>
                    <input type="number" id="bet-amount" class="form-control" placeholder="Taruhan (min. $100)" value="0">
                    <button class="btn btn-success" id="increase-bet">+100</button>
                    <button class="btn btn-primary" id="place-bet">Add Bet</button>
                </div>
            </div>

            <!-- Game Control Buttons -->
            <div class="col-md-6">
                <button class="btn btn-success me-2" id="hit" disabled>Take</button>
                <button class="btn btn-danger" id="stay" disabled>Hold</button>
            </div>
        </div>

        <!-- Game Result Display -->
        <div class="row mt-4">
            <div class="col-12">
                <h3 id="result" class="text-center"></h3>
            </div>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="game-over">
        <h1>Game Over</h1>
        <p>Uang Anda habis atau minus.</p>
        <button class="btn btn-primary" onclick="location.reload()">Main Lagi</button>
    </div>

    <script>
        // DOM Elements
        const playerCardsEl = document.getElementById('player-cards');
        const dealerCardsEl = document.getElementById('dealer-cards');
        const playerTotalEl = document.getElementById('player-total');
        const dealerTotalEl = document.getElementById('dealer-total');
        const playerMoneyEl = document.getElementById('player-money');
        const betAmountEl = document.getElementById('bet-amount');
        const placeBetBtn = document.getElementById('place-bet');
        const hitBtn = document.getElementById('hit');
        const stayBtn = document.getElementById('stay');
        const resultEl = document.getElementById('result');
        const gameOverEl = document.getElementById('game-over');
        const increaseBetBtn = document.getElementById('increase-bet');
        const decreaseBetBtn = document.getElementById('decrease-bet');

        // Variabel game
        let deck = [];
        let playerCards = [];
        let dealerCards = [];
        let playerMoney = 5000;
        let currentBet = 0;
        let gameInProgress = false;

        // Function untuk membuat dek kartu
        function createDeck() {
            const suits = ['♠', '♥', '♦', '♣'];
            const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
            deck = [];

            // Loop melalui setiap jenis kartu
            for (let suit of suits) {
                for (let value of values) {
                    deck.push({ suit, value });
                }
            }
        }

        // Function untuk mengocok dek kartu
        function shuffleDeck() {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        // Function untuk membagikan satu kartu dari dek
        function dealCard() {
            return deck.pop();
        }

        // Function untuk menghitung total nilai tangan kartu
        function calculateHandValue(hand) {
            let total = 0;
            let aces = 0;

            for (let card of hand) {
                if (card.value === 'A') {
                    aces++;
                    total += 11;
                } else if (['K', 'Q', 'J'].includes(card.value)) {
                    total += 10;
                } else {
                    total += parseInt(card.value);
                }
            }

            // Sesuaikan nilai As jika total melebihi 21
            while (total > 21 && aces > 0) {
                total -= 10;
                aces--;
            }

            return total;
        }

        // Function untuk memperbarui tampilan UI dengan status game saat ini
        function updateUI() {
            playerCardsEl.innerHTML = playerCards.map(card => {
                let suitClass = (card.suit === '♥' || card.suit === '♦') ? 'red-suit' : 'black-suit';
                return `<div class="card ${suitClass}">${card.value}${card.suit}</div>`;
            }).join('');

            dealerCardsEl.innerHTML = dealerCards.map((card, index) => {
                let suitClass = (card.suit === '♥' || card.suit === '♦') ? 'red-suit' : 'black-suit';
                return index === 0 || !gameInProgress
                    ? `<div class="card ${suitClass}">${card.value}${card.suit}</div>`
                    : '<div class="card closed">.</div>';
            }).join('');

            playerTotalEl.textContent = calculateHandValue(playerCards);
            dealerTotalEl.textContent = gameInProgress ? calculateHandValue([dealerCards[0]]) : calculateHandValue(dealerCards);
            playerMoneyEl.textContent = playerMoney;
        }

           // Function untuk memulai game baru
        function startGame() {
            if (currentBet < 100 || currentBet > playerMoney) {
                alert('Taruhan harus minimal $100 dan tidak melebihi uang Anda.');
                return;
            }

            gameInProgress = true;
            playerMoney -= currentBet;
            createDeck();
            shuffleDeck();
            playerCards = [dealCard(), dealCard()];
            dealerCards = [dealCard(), dealCard()];
            updateUI();

            // Aktifkan tombol kontrol game
            hitBtn.disabled = false;
            stayBtn.disabled = false;
            increaseBetBtn.disabled = true;
            decreaseBetBtn.disabled = true;
            placeBetBtn.disabled = true;
            betAmountEl.disabled = true;
            resultEl.textContent = '';
        }

        function hit() {
            playerCards.push(dealCard());
            updateUI();

            if (calculateHandValue(playerCards) > 21) {
                endGame('Anda bust! Bandar menang.');
            }
        }

        function stay() {
            gameInProgress = false;

            // Dealer harus mengambil kartu hingga total poin minimal 17
            while (calculateHandValue(dealerCards) < 17) {
                dealerCards.push(dealCard());
                updateUI();
            }

            determineWinner();
        }

        // Function untuk menentukan pemenang berdasarkan tangan pemain dan bandar
        function determineWinner() {
            const playerTotal = calculateHandValue(playerCards);
            const dealerTotal = calculateHandValue(dealerCards);

            if (playerTotal > 21) {
                endGame('Anda bust! Bandar menang.');
            } else if (dealerTotal > 21) {
                playerMoney += currentBet * 2;
                endGame('Bandar bust! Anda menang!');
            } else if (playerTotal > dealerTotal) {
                playerMoney += currentBet * 2;
                endGame('Anda menang!');
            } else if (dealerTotal > playerTotal) {
                endGame('Bandar menang.');
            } else {
                // Seri, taruhan dikembalikan ke pemain
                playerMoney += currentBet;
                endGame('Seri! Taruhan dikembalikan.');
            }
        }

        // Function untuk mengakhiri game dan memperbarui UI
        function endGame(message) {
            resultEl.textContent = message;
            hitBtn.disabled = true;
            stayBtn.disabled = true;
            increaseBetBtn.disabled = false;
            decreaseBetBtn.disabled = false;
            placeBetBtn.disabled = false;
            betAmountEl.disabled = false;

            // Check if the player is out of money
            if (playerMoney <= 0) {
                gameOverEl.style.display = 'block';
            }

            updateUI();
        }

        // Event Listeners untuk kontrol game
        placeBetBtn.addEventListener('click', () => {
            currentBet = parseInt(betAmountEl.value) || 0;
            startGame();
        });

        hitBtn.addEventListener('click', hit);
        stayBtn.addEventListener('click', stay);

        increaseBetBtn.addEventListener('click', () => {
            const bet = parseInt(betAmountEl.value) || 0;
            betAmountEl.value = bet + 100;
        });

        decreaseBetBtn.addEventListener('click', () => {
            const bet = parseInt(betAmountEl.value) || 0;
            if (bet >= 100) {
                betAmountEl.value = bet - 100;
            }
        });
    </script>
</body>

</html>
